---
import BaseLayout from "./BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import TableOfContents from "../components/TableOfContents.astro";
import ShareButtons from "../components/ShareButtons.astro";
import Comments from "../components/Comments.astro";
import { formatDate, readingTime } from "../utils/helpers";
import { SITE_CONFIG } from "../config";

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  tags?: string[];
  content: string;
  headings?: any[];
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags,
  content,
  headings = [],
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const estimatedReadingTime = readingTime(content);
---

<BaseLayout
  title={title}
  description={description}
  image={heroImage}
  type="article"
>
  <Header slot="header" />

  <article class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-32">
    <div class="lg:grid lg:grid-cols-[1fr_250px] lg:gap-8">
      <!-- Main Content -->
      <div class="max-w-3xl">
        <!-- Article Header -->
        <header class="mb-8">
          <h1
            class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4 mt-0"
          >
            {title}
          </h1>

          <div
            class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-4"
          >
            <time datetime={pubDate.toISOString()}>
              {formatDate(pubDate)}
            </time>
            <span>•</span>
            <span>{estimatedReadingTime}</span>
            {
              updatedDate && (
                <>
                  <span>•</span>
                  <span>Updated {formatDate(updatedDate)}</span>
                </>
              )
            }
          </div>

          {
            tags && tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mb-6">
                {tags.map((tag) => (
                  <a
                    href={`/tags/${tag}`}
                    class="inline-block px-3 py-1 text-sm font-medium bg-gray-100 dark:bg-gray-800 text-black dark:text-white rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors no-underline border border-gray-200 dark:border-gray-700"
                  >
                    {tag}
                  </a>
                ))}
              </div>
            )
          }

          {
            heroImage && (
              <img
                src={heroImage}
                alt={title}
                class="w-full h-auto rounded-lg shadow-lg mb-8"
                loading="eager"
              />
            )
          }
        </header>

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none">
          <slot />
        </div>

        <!-- Share Buttons -->
        <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
          <ShareButtons title={title} url={canonicalURL.toString()} />
        </div>

        <!-- Author Info (Optional) -->
        <div class="mt-8 p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <div class="flex items-center">
            <div>
              <h3
                class="text-lg font-semibold text-gray-900 dark:text-gray-100 mt-0 mb-2"
              >
                {SITE_CONFIG.site.author}
              </h3>
              <p class="text-gray-600 dark:text-gray-400 mb-0">
                {SITE_CONFIG.site.description}
              </p>
            </div>
          </div>
        </div>

        <!-- Comments Section -->
        {SITE_CONFIG.features.comments && <Comments />}
      </div>

      <!-- Table of Contents (Sidebar on desktop) -->
      <aside class="hidden lg:block">
        <TableOfContents headings={headings} />
      </aside>
    </div>
  </article>

  <Footer slot="footer" />
</BaseLayout>

<style is:global>
  /* Prose styling for blog content */
  .prose {
    color: #374151;
    max-width: none;
  }

  .prose h2 {
    margin-top: 2em;
    margin-bottom: 1em;
    font-size: 1.875rem;
    font-weight: 700;
    color: #111827;
  }

  .prose h3 {
    margin-top: 1.6em;
    margin-bottom: 0.8em;
    font-size: 1.5rem;
    font-weight: 600;
    color: #111827;
  }

  .prose p {
    margin-bottom: 1.25em;
    line-height: 1.75;
  }

  .prose a {
    color: var(--color-text);
    text-decoration: underline;
    text-decoration-color: var(--color-border);
    text-underline-offset: 4px;
    text-decoration-thickness: 1px;
  }

  .prose a:hover {
    color: var(--color-text);
    text-decoration-color: var(--color-text);
    text-decoration-thickness: 2px;
  }

  .prose ul,
  .prose ol {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
    padding-left: 1.625em;
  }

  .prose li {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }

  .prose img {
    margin-top: 2em;
    margin-bottom: 2em;
    border-radius: 0.5rem;
  }

  .prose blockquote {
    font-style: italic;
    border-left: 4px solid var(--color-text);
    padding-left: 1em;
    margin: 1.5em 0;
    color: #4b5563;
  }

  .prose code {
    background-color: #f3f4f6;
    padding: 0.2em 0.4em;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }

  .prose pre code {
    background-color: transparent;
    padding: 0;
  }

  .prose table {
    width: 100%;
    margin-top: 2em;
    margin-bottom: 2em;
    border-collapse: collapse;
  }

  .prose th {
    background-color: #f9fafb;
    font-weight: 600;
    padding: 0.75em;
    border: 1px solid #e5e7eb;
  }

  .prose td {
    padding: 0.75em;
    border: 1px solid #e5e7eb;
  }
</style>
