---
import { Image } from "astro:assets";
import { formatDate, readingTime, truncateText } from "../utils/helpers";

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  slug: string;
  heroImage?: string;
  tags?: string[];
  content?: string;
}

const { title, description, pubDate, slug, heroImage, tags, content } =
  Astro.props;

const truncatedDescription = truncateText(description, 150);
const estimatedReadingTime = content ? readingTime(content) : "5 min read";
---

<article
  class="group relative flex flex-col h-full border-2 border-dashed border-gray-900 dark:border-gray-100 p-4 transition-all hover:border-solid hover:bg-gray-50 dark:hover:bg-gray-900 rounded-xl"
>
  <!-- Hero Image -->
  {
    heroImage && (
      <a
        href={`/blog/${slug}`}
        class="block overflow-hidden mb-4 border border-gray-900 dark:border-gray-100"
      >
        <img
          src={heroImage}
          alt={title}
          class="w-full h-48 object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
          loading="lazy"
        />
      </a>
    )
  }

  <!-- Content -->
  <div class="flex flex-col flex-grow">
    <!-- Title -->
    <h3 class="mb-2 mt-0">
      <a
        href={`/blog/${slug}`}
        class="text-xl font-bold text-gray-900 dark:text-gray-100 decoration-2 underline-offset-4 group-hover:underline transition-all no-underline"
      >
        {title}
      </a>
    </h3>

    <!-- Metadata -->
    <div
      class="flex items-center text-sm font-mono text-gray-600 dark:text-gray-400 mb-3 border-b border-dashed border-gray-300 dark:border-gray-700 pb-2"
    >
      <time datetime={pubDate.toISOString()}>
        {formatDate(pubDate)}
      </time>
      <span class="mx-2">/</span>
      <span>{estimatedReadingTime}</span>
    </div>

    <!-- Description -->
    <p
      class="text-gray-800 dark:text-gray-300 mb-4 flex-grow font-serif leading-relaxed"
    >
      {truncatedDescription}
    </p>

    <!-- Tags -->
    {
      tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-auto pt-4 border-t border-dashed border-gray-300 dark:border-gray-700">
          {tags.slice(0, 3).map((tag) => (
            <a
              href={`/tags/${tag}`}
              class="inline-block px-2 py-1 text-xs font-bold text-gray-900 dark:text-gray-100 bg-transparent border border-gray-900 dark:border-gray-100 hover:bg-gray-900 hover:text-white dark:hover:bg-gray-100 dark:hover:text-black transition-colors no-underline uppercase tracking-wider"
            >
              {tag}
            </a>
          ))}
          {tags.length > 3 && (
            <span class="inline-block px-3 py-1 text-xs font-medium text-gray-600">
              +{tags.length - 3} more
            </span>
          )}
        </div>
      )
    }
  </div>
</article>
