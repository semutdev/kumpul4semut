---
import { Image } from 'astro:assets';
import { formatDate, readingTime, truncateText } from '../utils/helpers';

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  slug: string;
  heroImage?: string;
  tags?: string[];
  content?: string;
}

const { title, description, pubDate, slug, heroImage, tags, content } = Astro.props;

const truncatedDescription = truncateText(description, 150);
const estimatedReadingTime = content ? readingTime(content) : '5 min read';
---

<article class="group bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex flex-col h-full">
  <!-- Hero Image -->
  {heroImage && (
    <a href={`/blog/${slug}`} class="block overflow-hidden">
      <img
        src={heroImage}
        alt={title}
        class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    </a>
  )}

  <!-- Content -->
  <div class="p-6 flex flex-col flex-grow">
    <!-- Title -->
    <h3 class="mb-2 mt-0">
      <a
        href={`/blog/${slug}`}
        class="text-xl font-bold text-gray-900 hover:text-blue-600 transition-colors no-underline"
      >
        {title}
      </a>
    </h3>

    <!-- Metadata -->
    <div class="flex items-center text-sm text-gray-600 mb-3">
      <time datetime={pubDate.toISOString()}>
        {formatDate(pubDate)}
      </time>
      <span class="mx-2">â€¢</span>
      <span>{estimatedReadingTime}</span>
    </div>

    <!-- Description -->
    <p class="text-gray-700 mb-4 flex-grow">
      {truncatedDescription}
    </p>

    <!-- Tags -->
    {tags && tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mt-auto">
        {tags.slice(0, 3).map((tag) => (
          <a
            href={`/tags/${tag}`}
            class="inline-block px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full hover:bg-blue-200 transition-colors no-underline"
          >
            {tag}
          </a>
        ))}
        {tags.length > 3 && (
          <span class="inline-block px-3 py-1 text-xs font-medium text-gray-600">
            +{tags.length - 3} more
          </span>
        )}
      </div>
    )}
  </div>
</article>
