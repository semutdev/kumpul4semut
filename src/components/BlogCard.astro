---
import { Image } from "astro:assets";
import { formatDate, readingTime, truncateText } from "../utils/helpers";

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  slug: string;
  heroImage?: string;
  tags?: string[];
  content?: string;
}

const { title, description, pubDate, slug, heroImage, tags, content } =
  Astro.props;

const truncatedDescription = truncateText(description, 150);
const estimatedReadingTime = content ? readingTime(content) : "5 min read";
---

<article class="relative group h-full">
  <!-- Shadow for floating effect -->
  <div class="absolute inset-0 bg-black/10 blur-xl transform translate-y-2 translate-x-1 torn-corner rounded-sm"></div>

  <!-- Main Card -->
  <div class="relative h-full p-6 shadow-sm torn-corner paper-texture border-l-4 border-stone-300 transition-transform duration-300 group-hover:-translate-y-1 flex flex-col">
    
    <!-- Hero Image -->
    {
      heroImage && (
        <a href={`/blog/${slug}`} class="block mb-4 overflow-hidden rounded-sm border border-stone-200">
          <img
            src={heroImage}
            alt={title}
            class="w-full h-48 object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
            loading="lazy"
          />
        </a>
      )
    }

    <!-- Header -->
    <div class="mb-4">
      {tags && tags.length > 0 && (
        <span class="text-xs font-bold uppercase tracking-widest text-orange-600 block mb-1">
          {tags[0]}
        </span>
      )}
      <h3 class="text-2xl font-serif font-bold text-stone-800 mt-1 leading-tight">
        <a href={`/blog/${slug}`} class="hover:text-orange-700 transition-colors">
          {title}
        </a>
      </h3>
      <div class="flex items-center gap-2 mt-2 text-stone-500 text-sm">
        <time datetime={pubDate.toISOString()} class="italic">
          {formatDate(pubDate)}
        </time>
        <span>â€¢</span>
        <span>{estimatedReadingTime}</span>
      </div>
    </div>

    <!-- Content -->
    <p class="text-stone-700 leading-relaxed font-serif mb-4 flex-grow line-clamp-3">
      {truncatedDescription}
    </p>

    <!-- Footer -->
    <div class="mt-auto pt-4 flex justify-between items-center border-t border-stone-200 border-dashed">
      <a href={`/blog/${slug}`} class="text-stone-800 font-bold border-b-2 border-orange-400 hover:text-orange-600 transition-colors text-sm">
        Baca Selengkapnya
      </a>
      
      <!-- Decorative Element -->
      <div class="opacity-20 transform rotate-12 pointer-events-none">
        <svg width="24" height="24" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 5L35 35M5 35L35 5" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
        </svg>
      </div>
    </div>

    <!-- Book Spine Line -->
    <div class="absolute left-4 top-0 bottom-0 w-px bg-red-200/50 pointer-events-none"></div>
  </div>
</article>

<style>
  @import "../styles/torn-paper.css";
</style>
