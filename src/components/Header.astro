---
import { SITE_CONFIG } from "../config";
import Search from "./Search.astro";
import ThemeSwitcher from "./ThemeSwitcher.astro";

const currentPath = Astro.url.pathname;

const navItems = [
  { href: "/", label: "Home" },
  { href: "/blog", label: "Blog" },
  { href: "/tags", label: "Tags" },
  { href: "/about", label: "About" },
];

function isActive(href: string, currentPath: string): boolean {
  if (href === "/") {
    return currentPath === "/";
  }
  return currentPath.startsWith(href);
}
---

<header
  class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-[95%] max-w-5xl bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-lg transition-all"
>
  <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16 min-w-0">
      <!-- Logo / Site Title -->
      <div class="flex-shrink-0 min-w-0">
        <a
          href="/"
          class="flex items-center gap-2 sm:gap-3 text-lg sm:text-xl font-medium text-gray-900 dark:text-gray-100 hover:text-gray-600 dark:hover:text-gray-300 transition-colors no-underline"
        >
          <img
            src="/images/logo.png"
            alt="Kumpul4Semut Logo"
            class="h-8 sm:h-10 w-auto dark:hidden flex-shrink-0"
          />
          <img
            src="/images/logo-white.png"
            alt="Kumpul4Semut Logo"
            class="h-8 sm:h-10 w-auto hidden dark:block flex-shrink-0"
          />
          <span class="truncate font-bold">{SITE_CONFIG.site.title}</span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav
        class="hidden md:flex items-center space-x-4"
        aria-label="Main navigation"
      >
        <ul class="flex space-x-8 list-none m-0 p-0">
          {
            navItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class={`text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors no-underline font-medium ${
                    isActive(item.href, currentPath)
                      ? "text-black dark:text-white border-b-2 border-black dark:border-white"
                      : ""
                  }`}
                  aria-current={
                    isActive(item.href, currentPath) ? "page" : undefined
                  }
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>

        <!-- Search & Theme Switcher -->
        <div class="flex items-center gap-2">
          <Search />
          <ThemeSwitcher />
        </div>
      </nav>

      <!-- Mobile Actions -->
      <div class="md:hidden flex items-center gap-1">
        <!-- Search Button -->
        <div class="flex items-center p-1">
          <Search />
        </div>

        <!-- Theme Toggle Button -->
        <div class="flex items-center p-1">
          <ThemeSwitcher />
        </div>

        <!-- Mobile Menu Button -->
        <button
          type="button"
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 dark:text-gray-300 hover:text-black hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-gray-500"
          aria-expanded="false"
          aria-label="Toggle navigation menu"
          id="mobile-menu-button"
        >
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu (hidden by default) -->
  <div class="md:hidden hidden" id="mobile-menu">
    <div
      class="px-2 pt-2 pb-3 space-y-1 bg-transparent border-t border-gray-200 dark:border-gray-700"
    >
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class={`block px-3 py-2 rounded-md text-base font-medium no-underline ${
              isActive(item.href, currentPath)
                ? "bg-gray-100 dark:bg-gray-800 text-black dark:text-white"
                : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-black dark:hover:text-white"
            }`}
            aria-current={isActive(item.href, currentPath) ? "page" : undefined}
          >
            {item.label}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const button = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  if (button && menu) {
    button.addEventListener("click", () => {
      const isHidden = menu.classList.contains("hidden");
      menu.classList.toggle("hidden");
      button.setAttribute("aria-expanded", isHidden ? "true" : "false");
    });
  }
</script>
