---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import {
  filterDrafts,
  getUniqueTags,
  getTagCounts,
} from "../../content/config";

// Fetch all blog posts
const allPosts = await getCollection("blog");
const publishedPosts = filterDrafts(allPosts);

// Get unique tags and their counts
const tags = getUniqueTags(publishedPosts);
const tagCounts = getTagCounts(publishedPosts);
---

<BaseLayout title="Tags" description="Browse all tags">
  <Header slot="header" />

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 pt-32">
    <!-- Page Header -->
    <div class="mb-12">
      <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4 mt-0">
        Tags
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">
        Browse posts by topic
      </p>
    </div>

    <!-- Tags Grid -->
    {
      tags.length > 0 ? (
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {tags.map((tag) => (
            <a
              href={`/tags/${tag}`}
              class="group block p-6 bg-white dark:bg-gray-900 rounded-xl transition-all border-2 border-dashed border-gray-900 dark:border-gray-100 hover:border-solid hover:bg-gray-50 dark:hover:bg-gray-800 no-underline"
            >
              <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-black dark:group-hover:text-white transition-colors mt-0 mb-2">
                  {tag}
                </h2>
                <span class="inline-flex items-center justify-center px-3 py-1 text-sm font-medium bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-full border border-gray-200 dark:border-gray-700">
                  {tagCounts.get(tag)}
                </span>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-0">
                {tagCounts.get(tag)}{" "}
                {tagCounts.get(tag) === 1 ? "post" : "posts"}
              </p>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-20">
          <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
            No tags yet
          </h2>
          <p class="text-gray-600 dark:text-gray-400">
            Tags will appear here once posts are published!
          </p>
        </div>
      )
    }
  </div>

  <Footer slot="footer" />
</BaseLayout>
